import{u as B,h as c,c as N,p as M,i as U,n as D,a as m,b as t,g,d as i,t as v,m as E,j as x,v as _,e as I,w as P,r as R,o as b}from"./index-DoGX8M6O.js";import{p}from"./posts-JKtEoo8Q.js";const q={class:"container"},A={class:"row justify-content-center"},S={class:"col-lg-8"},j={class:"page-container fade-in"},H={class:"text-gradient mb-4"},K={key:0,class:"alert alert-danger",role:"alert"},z={key:1,class:"alert alert-success",role:"alert"},F={class:"mb-4"},L={class:"mb-4"},W={class:"mb-4"},X={key:0,class:"mt-3"},G=["src"],J={class:"d-flex gap-2"},O={type:"submit",class:"btn btn-primary px-4"},$={__name:"CreatePost",setup(Q){const f=D(),h=M(),{currentUser:w}=B(),a=c({title:"",content:"",image:""}),r=c(""),l=c(""),u=c(""),y=c(!1),d=N(()=>!!h.params.id);U(()=>{d.value&&k()});const k=async()=>{try{const s=await p.getById(h.params.id);if(s.authorId!==w.value.id){l.value="Bạn không có quyền chỉnh sửa bài viết này",setTimeout(()=>f.push("/"),2e3);return}a.value={title:s.title,content:s.content,image:s.image||""},s.image&&(r.value=s.image)}catch(s){l.value="Không tìm thấy bài viết",console.error("Error loading post:",s)}},C=s=>{const e=s.target.files[0];if(!e)return;if(e.size>2*1024*1024){l.value="Kích thước file phải nhỏ hơn 2MB";return}if(!e.type.startsWith("image/")){l.value="Vui lòng chọn file hình ảnh";return}const n=new FileReader;n.onload=o=>{a.value.image=o.target.result,r.value=o.target.result},n.readAsDataURL(e)},V=()=>{a.value.image="",r.value=""},T=async()=>{var s,e;l.value="",u.value="",y.value=!0;try{d.value?(await p.update(h.params.id,{title:a.value.title,content:a.value.content,image:a.value.image||null}),u.value="Cập nhật bài viết thành công!"):(await p.create({title:a.value.title,content:a.value.content,image:a.value.image||null}),u.value="Đăng bài thành công!"),setTimeout(()=>f.push("/"),1e3)}catch(n){l.value=((e=(s=n.response)==null?void 0:s.data)==null?void 0:e.message)||"Có lỗi xảy ra",console.error("Error submitting post:",n)}finally{y.value=!1}};return(s,e)=>{const n=R("router-link");return b(),m("div",q,[t("div",A,[t("div",S,[t("div",j,[t("h2",H,[e[2]||(e[2]=t("i",{class:"bi bi-plus-circle me-2"},null,-1)),i(" "+v(d.value?"Chỉnh sửa bài viết":"Tạo bài viết mới"),1)]),l.value?(b(),m("div",K,[e[3]||(e[3]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),i(" "+v(l.value),1)])):g("",!0),u.value?(b(),m("div",z,[e[4]||(e[4]=t("i",{class:"bi bi-check-circle me-2"},null,-1)),i(" "+v(u.value),1)])):g("",!0),t("form",{onSubmit:E(T,["prevent"])},[t("div",F,[e[5]||(e[5]=t("label",{for:"title",class:"form-label"},[t("i",{class:"bi bi-card-heading me-1"}),i(" Tiêu đề ")],-1)),x(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=o=>a.value.title=o),required:"",placeholder:"Nhập tiêu đề bài viết"},null,512),[[_,a.value.title]])]),t("div",L,[e[6]||(e[6]=t("label",{for:"content",class:"form-label"},[t("i",{class:"bi bi-file-text me-1"}),i(" Nội dung ")],-1)),x(t("textarea",{class:"form-control",id:"content","onUpdate:modelValue":e[1]||(e[1]=o=>a.value.content=o),required:"",rows:"8",placeholder:"Viết nội dung bài viết của bạn..."},null,512),[[_,a.value.content]])]),t("div",W,[e[8]||(e[8]=t("label",{for:"image",class:"form-label"},[t("i",{class:"bi bi-image me-1"}),i(" Hình ảnh minh họa ")],-1)),t("input",{type:"file",class:"form-control",id:"image",onChange:C,accept:"image/*"},null,32),e[9]||(e[9]=t("small",{class:"text-secondary"},"Tùy chọn: Chọn hình ảnh để minh họa cho bài viết",-1)),r.value?(b(),m("div",X,[t("img",{src:r.value,alt:"Preview",class:"img-fluid rounded",style:{"max-height":"300px"}},null,8,G),t("button",{type:"button",onClick:V,class:"btn btn-sm btn-outline-danger mt-2"},[...e[7]||(e[7]=[t("i",{class:"bi bi-x-circle me-1"},null,-1),i(" Xóa hình ảnh ",-1)])])])):g("",!0)]),t("div",J,[t("button",O,[e[10]||(e[10]=t("i",{class:"bi bi-check-circle me-2"},null,-1)),i(" "+v(d.value?"Cập nhật":"Đăng bài"),1)]),I(n,{to:"/",class:"btn btn-outline-secondary px-4"},{default:P(()=>[...e[11]||(e[11]=[t("i",{class:"bi bi-x-circle me-2"},null,-1),i(" Hủy ",-1)])]),_:1})])],32)])])])])}}};export{$ as default};

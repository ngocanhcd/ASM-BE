import{u as P,i as p,c as k,r as U,b as a,o as l,d as t,e as r,t as u,m as M,k as L,v as q,q as j,f as w,w as B,F as E,l as F,h as f,a as V,_ as R,j as T,x as G,p as N,n as h,s as H}from"./index-CvyPqeqL.js";const K={class:"comments-section mt-4"},O={class:"mb-4"},X={key:0,class:"mb-4"},z={class:"mb-3"},J=["disabled"],Q={key:1,class:"alert alert-info"},W={key:2,class:"comments-list"},Y={class:"d-flex align-items-start gap-3"},Z=["src","alt"],tt={class:"flex-grow-1"},et={class:"d-flex justify-content-between align-items-start mb-2"},nt={class:"comment-author"},st={class:"comment-time"},ot=["onClick"],at={class:"mb-0"},lt={key:3,class:"empty-state"},it={__name:"CommentList",props:{comments:{type:Array,required:!0}},emits:["add-comment","delete-comment"],setup(g,{emit:$}){const x=g,v=$,{isAuthenticated:C,currentUser:o}=P(),d=p(""),m=k(()=>[...x.comments].sort((i,e)=>new Date(e.createdAt)-new Date(i.createdAt))),c=()=>{d.value.trim()&&(v("add-comment",d.value),d.value="")},_=i=>{const e=V.findById(i);return(e==null?void 0:e.name)||"Unknown User"},D=i=>{const e=V.findById(i);return(e==null?void 0:e.avatar)||`https://ui-avatars.com/api/?name=${(e==null?void 0:e.name)||"U"}&background=6366f1&color=fff`},A=i=>{const e=new Date(i),s=new Date-e,n=Math.floor(s/6e4),b=Math.floor(s/36e5),S=Math.floor(s/864e5);return n<1?"Vừa xong":n<60?`${n} phút trước`:b<24?`${b} giờ trước`:S<7?`${S} ngày trước`:e.toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric"})},I=i=>o.value&&o.value.id===i.authorId;return(i,e)=>{const y=U("router-link");return l(),a("div",K,[t("h4",O,[e[1]||(e[1]=t("i",{class:"bi bi-chat-dots me-2"},null,-1)),r(" Bình luận ("+u(g.comments.length)+") ",1)]),M(C)?(l(),a("div",X,[t("form",{onSubmit:j(c,["prevent"]),class:"glass-effect p-3 rounded"},[t("div",z,[L(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),class:"form-control",placeholder:"Viết bình luận của bạn...",rows:"3",required:""},null,512),[[q,d.value]])]),t("button",{type:"submit",class:"btn btn-primary",disabled:!d.value.trim()},[...e[2]||(e[2]=[t("i",{class:"bi bi-send me-1"},null,-1),r(" Gửi bình luận ",-1)])],8,J)],32)])):(l(),a("div",Q,[e[4]||(e[4]=t("i",{class:"bi bi-info-circle me-2"},null,-1)),e[5]||(e[5]=r(" Vui lòng ",-1)),w(y,{to:"/login"},{default:B(()=>[...e[3]||(e[3]=[r("đăng nhập",-1)])]),_:1}),e[6]||(e[6]=r(" để bình luận ",-1))])),g.comments.length>0?(l(),a("div",W,[(l(!0),a(E,null,F(m.value,s=>(l(),a("div",{key:s.id,class:"comment-item fade-in"},[t("div",Y,[t("img",{src:D(s.authorId),alt:_(s.authorId),class:"avatar"},null,8,Z),t("div",tt,[t("div",et,[t("div",null,[t("div",nt,u(_(s.authorId)),1),t("div",st,u(A(s.createdAt)),1)]),I(s)?(l(),a("button",{key:0,onClick:n=>i.$emit("delete-comment",s.id),class:"btn btn-sm btn-outline-danger"},[...e[7]||(e[7]=[t("i",{class:"bi bi-trash"},null,-1)])],8,ot)):f("",!0)]),t("p",at,u(s.content),1)])])]))),128))])):(l(),a("div",lt,[...e[8]||(e[8]=[t("i",{class:"bi bi-chat-text"},null,-1),t("p",null,"Chưa có bình luận nào. Hãy là người đầu tiên bình luận!",-1)])]))])}}},rt={class:"container"},dt={key:0,class:"text-center py-5"},ut={key:1,class:"page-container"},ct={class:"alert alert-danger"},mt={key:2,class:"row"},vt={class:"col-lg-8 mx-auto"},bt={class:"page-container fade-in"},ht={class:"mb-4"},pt={class:"mb-3"},ft={class:"post-meta mb-3"},gt={key:0},_t={key:0,class:"d-flex gap-2 mb-3"},yt={key:0,class:"mb-4"},kt=["src","alt"],wt={class:"post-content mb-5"},$t={style:{"white-space":"pre-wrap"}},xt={__name:"PostDetail",setup(g){const $=G(),x=H(),{currentUser:v,isAuthenticated:C}=P(),o=p(null),d=p([]),m=p(!0),c=p(""),_=k(()=>{if(!o.value)return"";const s=V.findById(o.value.authorId);return(s==null?void 0:s.name)||"Unknown"}),D=k(()=>o.value?new Date(o.value.createdAt).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):""),A=k(()=>v.value&&o.value&&v.value.id===o.value.authorId),I=()=>{m.value=!0,c.value="";const s=$.params.id,n=N.findById(s);if(!n){c.value="Không tìm thấy bài viết",m.value=!1;return}o.value=n,d.value=h.getByPostId(s),m.value=!1},i=s=>{if(!C.value){c.value="Vui lòng đăng nhập để bình luận";return}const n={id:Date.now().toString(),postId:o.value.id,authorId:v.value.id,content:s,createdAt:new Date().toISOString()};h.add(n),d.value=h.getByPostId(o.value.id)},e=s=>{confirm("Bạn có chắc chắn muốn xóa bình luận này?")&&(h.delete(s),d.value=h.getByPostId(o.value.id))},y=()=>{confirm("Bạn có chắc chắn muốn xóa bài viết này?")&&(N.delete(o.value.id),x.push("/"))};return T(()=>{I()}),(s,n)=>{const b=U("router-link");return l(),a("div",rt,[m.value?(l(),a("div",dt,[...n[0]||(n[0]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)])])):c.value?(l(),a("div",ut,[t("div",ct,[n[1]||(n[1]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),r(" "+u(c.value),1)]),w(b,{to:"/",class:"btn btn-primary"},{default:B(()=>[...n[2]||(n[2]=[t("i",{class:"bi bi-arrow-left me-2"},null,-1),r(" Về trang chủ ",-1)])]),_:1})])):o.value?(l(),a("div",mt,[t("div",vt,[t("div",bt,[t("div",ht,[t("h1",pt,u(o.value.title),1),t("div",ft,[t("span",null,[n[3]||(n[3]=t("i",{class:"bi bi-person-circle"},null,-1)),r(" "+u(_.value),1)]),t("span",null,[n[4]||(n[4]=t("i",{class:"bi bi-calendar"},null,-1)),r(" "+u(D.value),1)]),o.value.updatedAt!==o.value.createdAt?(l(),a("span",gt,[...n[5]||(n[5]=[t("i",{class:"bi bi-pencil"},null,-1),r(" Đã chỉnh sửa ",-1)])])):f("",!0)]),A.value?(l(),a("div",_t,[w(b,{to:`/posts/${o.value.id}/edit`,class:"btn btn-outline-primary"},{default:B(()=>[...n[6]||(n[6]=[t("i",{class:"bi bi-pencil me-1"},null,-1),r(" Chỉnh sửa ",-1)])]),_:1},8,["to"]),t("button",{onClick:y,class:"btn btn-outline-danger"},[...n[7]||(n[7]=[t("i",{class:"bi bi-trash me-1"},null,-1),r(" Xóa ",-1)])])])):f("",!0)]),o.value.image?(l(),a("div",yt,[t("img",{src:o.value.image,alt:o.value.title,class:"img-fluid rounded shadow"},null,8,kt)])):f("",!0),t("div",wt,[t("p",$t,u(o.value.content),1)]),n[8]||(n[8]=t("hr",{class:"my-5"},null,-1)),w(it,{comments:d.value,onAddComment:i,onDeleteComment:e},null,8,["comments"])])])])):f("",!0)])}}},Dt=R(xt,[["__scopeId","data-v-196ae47c"]]);export{Dt as default};

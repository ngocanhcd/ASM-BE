import{u as V,i as d,c as D,x as I,j as T,p as g,s as B,b as m,d as t,h as p,e as a,t as v,q as N,k as x,v as _,f as M,w as P,r as U,o as b}from"./index-CvyPqeqL.js";const q={class:"container"},A={class:"row justify-content-center"},R={class:"col-lg-8"},j={class:"page-container fade-in"},E={class:"text-gradient mb-4"},H={key:0,class:"alert alert-danger",role:"alert"},K={key:1,class:"alert alert-success",role:"alert"},O={class:"mb-4"},z={class:"mb-4"},F={class:"mb-4"},L={key:0,class:"mt-3"},W=["src"],X={class:"d-flex gap-2"},G={type:"submit",class:"btn btn-primary px-4"},Y={__name:"CreatePost",setup(J){const f=B(),h=I(),{currentUser:y}=V(),s=d({title:"",content:"",image:""}),o=d(""),l=d(""),r=d(""),u=D(()=>!!h.params.id);T(()=>{u.value&&w()});const w=()=>{const i=g.findById(h.params.id);if(!i){l.value="Không tìm thấy bài viết";return}if(i.authorId!==y.value.id){l.value="Bạn không có quyền chỉnh sửa bài viết này",setTimeout(()=>f.push("/"),2e3);return}s.value={title:i.title,content:i.content,image:i.image||""},i.image&&(o.value=i.image)},k=i=>{const e=i.target.files[0];if(!e)return;if(e.size>2*1024*1024){l.value="Kích thước file phải nhỏ hơn 2MB";return}if(!e.type.startsWith("image/")){l.value="Vui lòng chọn file hình ảnh";return}const c=new FileReader;c.onload=n=>{s.value.image=n.target.result,o.value=n.target.result},c.readAsDataURL(e)},C=()=>{s.value.image="",o.value=""},S=()=>{l.value="",r.value="";try{if(u.value)g.update(h.params.id,{title:s.value.title,content:s.value.content,image:s.value.image}),r.value="Cập nhật bài viết thành công!";else{const i={id:Date.now().toString(),title:s.value.title,content:s.value.content,image:s.value.image,authorId:y.value.id,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};g.add(i),r.value="Đăng bài thành công!"}setTimeout(()=>f.push("/"),1e3)}catch(i){l.value=i.message}};return(i,e)=>{const c=U("router-link");return b(),m("div",q,[t("div",A,[t("div",R,[t("div",j,[t("h2",E,[e[2]||(e[2]=t("i",{class:"bi bi-plus-circle me-2"},null,-1)),a(" "+v(u.value?"Chỉnh sửa bài viết":"Tạo bài viết mới"),1)]),l.value?(b(),m("div",H,[e[3]||(e[3]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),a(" "+v(l.value),1)])):p("",!0),r.value?(b(),m("div",K,[e[4]||(e[4]=t("i",{class:"bi bi-check-circle me-2"},null,-1)),a(" "+v(r.value),1)])):p("",!0),t("form",{onSubmit:N(S,["prevent"])},[t("div",O,[e[5]||(e[5]=t("label",{for:"title",class:"form-label"},[t("i",{class:"bi bi-card-heading me-1"}),a(" Tiêu đề ")],-1)),x(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=n=>s.value.title=n),required:"",placeholder:"Nhập tiêu đề bài viết"},null,512),[[_,s.value.title]])]),t("div",z,[e[6]||(e[6]=t("label",{for:"content",class:"form-label"},[t("i",{class:"bi bi-file-text me-1"}),a(" Nội dung ")],-1)),x(t("textarea",{class:"form-control",id:"content","onUpdate:modelValue":e[1]||(e[1]=n=>s.value.content=n),required:"",rows:"8",placeholder:"Viết nội dung bài viết của bạn..."},null,512),[[_,s.value.content]])]),t("div",F,[e[8]||(e[8]=t("label",{for:"image",class:"form-label"},[t("i",{class:"bi bi-image me-1"}),a(" Hình ảnh minh họa ")],-1)),t("input",{type:"file",class:"form-control",id:"image",onChange:k,accept:"image/*"},null,32),e[9]||(e[9]=t("small",{class:"text-secondary"},"Tùy chọn: Chọn hình ảnh để minh họa cho bài viết",-1)),o.value?(b(),m("div",L,[t("img",{src:o.value,alt:"Preview",class:"img-fluid rounded",style:{"max-height":"300px"}},null,8,W),t("button",{type:"button",onClick:C,class:"btn btn-sm btn-outline-danger mt-2"},[...e[7]||(e[7]=[t("i",{class:"bi bi-x-circle me-1"},null,-1),a(" Xóa hình ảnh ",-1)])])])):p("",!0)]),t("div",X,[t("button",G,[e[10]||(e[10]=t("i",{class:"bi bi-check-circle me-2"},null,-1)),a(" "+v(u.value?"Cập nhật":"Đăng bài"),1)]),M(c,{to:"/",class:"btn btn-outline-secondary px-4"},{default:P(()=>[...e[11]||(e[11]=[t("i",{class:"bi bi-x-circle me-2"},null,-1),a(" Hủy ",-1)])]),_:1})])],32)])])])])}}};export{Y as default};

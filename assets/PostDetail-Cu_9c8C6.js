import{q as V,u as E,h as g,c as $,r as M,a,o as l,b as t,d as u,t as d,l as L,j as P,v as K,m as S,e as k,w as N,F as q,k as j,g as y,_ as F,i as R,p as T,n as G}from"./index-BQ-V0sSv.js";import{p as U}from"./posts-DlvU_W3w.js";const I={async getByPostId(c){return(await V.get(`/posts/${c}/comments`)).data},async create(c,m){return(await V.post(`/posts/${c}/comments`,m)).data},async delete(c,m){await V.delete(`/posts/${c}/comments/${m}`)}},H={class:"comments-section mt-4"},X={class:"mb-4"},z={key:0,class:"mb-4"},J={class:"mb-3"},O=["disabled"],Q={key:1,class:"alert alert-info"},W={key:2,class:"comments-list"},Y={class:"d-flex align-items-start gap-3"},Z=["src","alt"],tt={class:"flex-grow-1"},et={class:"d-flex justify-content-between align-items-start mb-2"},st={class:"comment-author"},nt={class:"comment-time"},ot=["onClick"],at={class:"mb-0"},lt={key:3,class:"empty-state"},it={__name:"CommentList",props:{comments:{type:Array,required:!0}},emits:["add-comment","delete-comment"],setup(c,{emit:m}){const p=c,_=m,{isAuthenticated:x,currentUser:o}=E(),r=g(""),b=$(()=>[...p.comments].sort((i,e)=>new Date(e.createdAt)-new Date(i.createdAt))),v=()=>{r.value.trim()&&(_("add-comment",r.value),r.value="")},w=i=>{const e=p.comments.find(h=>h.authorId===i);return(e==null?void 0:e.authorName)||"Unknown User"},C=i=>{const e=p.comments.find(n=>n.authorId===i);return`https://ui-avatars.com/api/?name=${(e==null?void 0:e.authorName)||"U"}&background=6366f1&color=fff`},A=i=>{const e=new Date(i),n=new Date-e,s=Math.floor(n/6e4),f=Math.floor(n/36e5),B=Math.floor(n/864e5);return s<1?"Vừa xong":s<60?`${s} phút trước`:f<24?`${f} giờ trước`:B<7?`${B} ngày trước`:e.toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric"})},D=i=>o.value&&o.value.id===i.authorId;return(i,e)=>{const h=M("router-link");return l(),a("div",H,[t("h4",X,[e[1]||(e[1]=t("i",{class:"bi bi-chat-dots me-2"},null,-1)),u(" Bình luận ("+d(c.comments.length)+") ",1)]),L(x)?(l(),a("div",z,[t("form",{onSubmit:S(v,["prevent"]),class:"glass-effect p-3 rounded"},[t("div",J,[P(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=n=>r.value=n),class:"form-control",placeholder:"Viết bình luận của bạn...",rows:"3",required:""},null,512),[[K,r.value]])]),t("button",{type:"submit",class:"btn btn-primary",disabled:!r.value.trim()},[...e[2]||(e[2]=[t("i",{class:"bi bi-send me-1"},null,-1),u(" Gửi bình luận ",-1)])],8,O)],32)])):(l(),a("div",Q,[e[4]||(e[4]=t("i",{class:"bi bi-info-circle me-2"},null,-1)),e[5]||(e[5]=u(" Vui lòng ",-1)),k(h,{to:"/login"},{default:N(()=>[...e[3]||(e[3]=[u("đăng nhập",-1)])]),_:1}),e[6]||(e[6]=u(" để bình luận ",-1))])),c.comments.length>0?(l(),a("div",W,[(l(!0),a(q,null,j(b.value,n=>(l(),a("div",{key:n.id,class:"comment-item fade-in"},[t("div",Y,[t("img",{src:C(n.authorId),alt:w(n.authorId),class:"avatar"},null,8,Z),t("div",tt,[t("div",et,[t("div",null,[t("div",st,d(w(n.authorId)),1),t("div",nt,d(A(n.createdAt)),1)]),D(n)?(l(),a("button",{key:0,onClick:s=>i.$emit("delete-comment",n.id),class:"btn btn-sm btn-outline-danger"},[...e[7]||(e[7]=[t("i",{class:"bi bi-trash"},null,-1)])],8,ot)):y("",!0)]),t("p",at,d(n.content),1)])])]))),128))])):(l(),a("div",lt,[...e[8]||(e[8]=[t("i",{class:"bi bi-chat-text"},null,-1),t("p",null,"Chưa có bình luận nào. Hãy là người đầu tiên bình luận!",-1)])]))])}}},rt={class:"container"},ut={key:0,class:"text-center py-5"},ct={key:1,class:"page-container"},dt={class:"alert alert-danger"},mt={key:2,class:"row"},vt={class:"col-lg-8 mx-auto"},ht={class:"page-container fade-in"},pt={class:"mb-4"},bt={class:"mb-3"},ft={class:"post-meta mb-3"},gt={key:0},yt={key:0,class:"d-flex gap-2 mb-3"},_t={key:0,class:"mb-4"},wt=["src","alt"],$t={class:"post-content mb-5"},kt={style:{"white-space":"pre-wrap"}},xt={__name:"PostDetail",setup(c){const m=T(),p=G(),{currentUser:_,isAuthenticated:x}=E(),o=g(null),r=g([]),b=g(!0),v=g(""),w=$(()=>o.value?o.value.authorName||"Unknown":""),C=$(()=>o.value?new Date(o.value.createdAt).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):""),A=$(()=>_.value&&o.value&&_.value.id===o.value.authorId),D=async()=>{b.value=!0,v.value="";try{const n=m.params.id;o.value=await U.getById(n),r.value=await I.getByPostId(n)}catch(n){v.value="Không tìm thấy bài viết",console.error("Error loading post:",n)}finally{b.value=!1}},i=async n=>{if(!x.value){v.value="Vui lòng đăng nhập để bình luận";return}try{const s=await I.create(o.value.id,{content:n});r.value.push(s)}catch(s){alert("Không thể thêm bình luận"),console.error("Error adding comment:",s)}},e=async n=>{if(confirm("Bạn có chắc chắn muốn xóa bình luận này?"))try{await I.delete(o.value.id,n),r.value=r.value.filter(s=>s.id!==n)}catch(s){alert("Không thể xóa bình luận"),console.error("Error deleting comment:",s)}},h=async()=>{if(confirm("Bạn có chắc chắn muốn xóa bài viết này?"))try{await U.delete(o.value.id),p.push("/")}catch(n){alert("Không thể xóa bài viết"),console.error("Error deleting post:",n)}};return R(()=>{D()}),(n,s)=>{const f=M("router-link");return l(),a("div",rt,[b.value?(l(),a("div",ut,[...s[0]||(s[0]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)])])):v.value?(l(),a("div",ct,[t("div",dt,[s[1]||(s[1]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),u(" "+d(v.value),1)]),k(f,{to:"/",class:"btn btn-primary"},{default:N(()=>[...s[2]||(s[2]=[t("i",{class:"bi bi-arrow-left me-2"},null,-1),u(" Về trang chủ ",-1)])]),_:1})])):o.value?(l(),a("div",mt,[t("div",vt,[t("div",ht,[t("div",pt,[t("h1",bt,d(o.value.title),1),t("div",ft,[t("span",null,[s[3]||(s[3]=t("i",{class:"bi bi-person-circle"},null,-1)),u(" "+d(w.value),1)]),t("span",null,[s[4]||(s[4]=t("i",{class:"bi bi-calendar"},null,-1)),u(" "+d(C.value),1)]),o.value.updatedAt!==o.value.createdAt?(l(),a("span",gt,[...s[5]||(s[5]=[t("i",{class:"bi bi-pencil"},null,-1),u(" Đã chỉnh sửa ",-1)])])):y("",!0)]),A.value?(l(),a("div",yt,[k(f,{to:`/posts/${o.value.id}/edit`,class:"btn btn-outline-primary"},{default:N(()=>[...s[6]||(s[6]=[t("i",{class:"bi bi-pencil me-1"},null,-1),u(" Chỉnh sửa ",-1)])]),_:1},8,["to"]),t("button",{onClick:h,class:"btn btn-outline-danger"},[...s[7]||(s[7]=[t("i",{class:"bi bi-trash me-1"},null,-1),u(" Xóa ",-1)])])])):y("",!0)]),o.value.image?(l(),a("div",_t,[t("img",{src:o.value.image,alt:o.value.title,class:"img-fluid rounded shadow"},null,8,wt)])):y("",!0),t("div",$t,[t("p",kt,d(o.value.content),1)]),s[8]||(s[8]=t("hr",{class:"my-5"},null,-1)),k(it,{comments:r.value,onAddComment:i,onDeleteComment:e},null,8,["comments"])])])])):y("",!0)])}}},Dt=F(xt,[["__scopeId","data-v-fe4a19c9"]]);export{Dt as default};

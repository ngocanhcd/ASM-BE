import{q as V,u as M,h as b,c as $,r as L,a,o as l,b as t,d as u,t as d,l as P,j as S,v as K,m as q,e as k,w as I,F as j,k as F,g,s as U,_ as R,i as T,p as G,n as H}from"./index-DoGX8M6O.js";import{p as E}from"./posts-JKtEoo8Q.js";const B={async getByPostId(c){return(await V.get(`/posts/${c}/comments`)).data},async create(c,m){return(await V.post(`/posts/${c}/comments`,m)).data},async delete(c,m){await V.delete(`/posts/${c}/comments/${m}`)}},X={class:"comments-section mt-4"},z={class:"mb-4"},J={key:0,class:"mb-4"},O={class:"mb-3"},Q=["disabled"],W={key:1,class:"alert alert-info"},Y={key:2,class:"comments-list"},Z={class:"d-flex align-items-start gap-3"},tt=["src","alt"],et={class:"flex-grow-1"},st={class:"d-flex justify-content-between align-items-start mb-2"},nt={class:"comment-author"},ot={class:"comment-time"},at=["onClick"],lt={class:"mb-0"},it={key:3,class:"empty-state"},rt={__name:"CommentList",props:{comments:{type:Array,required:!0}},emits:["add-comment","delete-comment"],setup(c,{emit:m}){const f=c,y=m,{isAuthenticated:x,currentUser:o}=M(),r=b(""),p=$(()=>[...f.comments].sort((i,e)=>new Date(e.createdAt)-new Date(i.createdAt))),v=()=>{r.value.trim()&&(y("add-comment",r.value),r.value="")},_=i=>{const e=U.findById(i);return(e==null?void 0:e.name)||"Unknown User"},C=i=>{const e=U.findById(i);return(e==null?void 0:e.avatar)||`https://ui-avatars.com/api/?name=${(e==null?void 0:e.name)||"U"}&background=6366f1&color=fff`},A=i=>{const e=new Date(i),n=new Date-e,s=Math.floor(n/6e4),h=Math.floor(n/36e5),N=Math.floor(n/864e5);return s<1?"Vừa xong":s<60?`${s} phút trước`:h<24?`${h} giờ trước`:N<7?`${N} ngày trước`:e.toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric"})},D=i=>o.value&&o.value.id===i.authorId;return(i,e)=>{const w=L("router-link");return l(),a("div",X,[t("h4",z,[e[1]||(e[1]=t("i",{class:"bi bi-chat-dots me-2"},null,-1)),u(" Bình luận ("+d(c.comments.length)+") ",1)]),P(x)?(l(),a("div",J,[t("form",{onSubmit:q(v,["prevent"]),class:"glass-effect p-3 rounded"},[t("div",O,[S(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=n=>r.value=n),class:"form-control",placeholder:"Viết bình luận của bạn...",rows:"3",required:""},null,512),[[K,r.value]])]),t("button",{type:"submit",class:"btn btn-primary",disabled:!r.value.trim()},[...e[2]||(e[2]=[t("i",{class:"bi bi-send me-1"},null,-1),u(" Gửi bình luận ",-1)])],8,Q)],32)])):(l(),a("div",W,[e[4]||(e[4]=t("i",{class:"bi bi-info-circle me-2"},null,-1)),e[5]||(e[5]=u(" Vui lòng ",-1)),k(w,{to:"/login"},{default:I(()=>[...e[3]||(e[3]=[u("đăng nhập",-1)])]),_:1}),e[6]||(e[6]=u(" để bình luận ",-1))])),c.comments.length>0?(l(),a("div",Y,[(l(!0),a(j,null,F(p.value,n=>(l(),a("div",{key:n.id,class:"comment-item fade-in"},[t("div",Z,[t("img",{src:C(n.authorId),alt:_(n.authorId),class:"avatar"},null,8,tt),t("div",et,[t("div",st,[t("div",null,[t("div",nt,d(_(n.authorId)),1),t("div",ot,d(A(n.createdAt)),1)]),D(n)?(l(),a("button",{key:0,onClick:s=>i.$emit("delete-comment",n.id),class:"btn btn-sm btn-outline-danger"},[...e[7]||(e[7]=[t("i",{class:"bi bi-trash"},null,-1)])],8,at)):g("",!0)]),t("p",lt,d(n.content),1)])])]))),128))])):(l(),a("div",it,[...e[8]||(e[8]=[t("i",{class:"bi bi-chat-text"},null,-1),t("p",null,"Chưa có bình luận nào. Hãy là người đầu tiên bình luận!",-1)])]))])}}},ut={class:"container"},ct={key:0,class:"text-center py-5"},dt={key:1,class:"page-container"},mt={class:"alert alert-danger"},vt={key:2,class:"row"},pt={class:"col-lg-8 mx-auto"},ht={class:"page-container fade-in"},bt={class:"mb-4"},gt={class:"mb-3"},ft={class:"post-meta mb-3"},yt={key:0},_t={key:0,class:"d-flex gap-2 mb-3"},wt={key:0,class:"mb-4"},$t=["src","alt"],kt={class:"post-content mb-5"},xt={style:{"white-space":"pre-wrap"}},Ct={__name:"PostDetail",setup(c){const m=G(),f=H(),{currentUser:y,isAuthenticated:x}=M(),o=b(null),r=b([]),p=b(!0),v=b(""),_=$(()=>o.value?o.value.authorName||"Unknown":""),C=$(()=>o.value?new Date(o.value.createdAt).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):""),A=$(()=>y.value&&o.value&&y.value.id===o.value.authorId),D=async()=>{p.value=!0,v.value="";try{const n=m.params.id;o.value=await E.getById(n),r.value=await B.getByPostId(n)}catch(n){v.value="Không tìm thấy bài viết",console.error("Error loading post:",n)}finally{p.value=!1}},i=async n=>{if(!x.value){v.value="Vui lòng đăng nhập để bình luận";return}try{const s=await B.create(o.value.id,{content:n});r.value.push(s)}catch(s){alert("Không thể thêm bình luận"),console.error("Error adding comment:",s)}},e=async n=>{if(confirm("Bạn có chắc chắn muốn xóa bình luận này?"))try{await B.delete(o.value.id,n),r.value=r.value.filter(s=>s.id!==n)}catch(s){alert("Không thể xóa bình luận"),console.error("Error deleting comment:",s)}},w=async()=>{if(confirm("Bạn có chắc chắn muốn xóa bài viết này?"))try{await E.delete(o.value.id),f.push("/")}catch(n){alert("Không thể xóa bài viết"),console.error("Error deleting post:",n)}};return T(()=>{D()}),(n,s)=>{const h=L("router-link");return l(),a("div",ut,[p.value?(l(),a("div",ct,[...s[0]||(s[0]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)])])):v.value?(l(),a("div",dt,[t("div",mt,[s[1]||(s[1]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),u(" "+d(v.value),1)]),k(h,{to:"/",class:"btn btn-primary"},{default:I(()=>[...s[2]||(s[2]=[t("i",{class:"bi bi-arrow-left me-2"},null,-1),u(" Về trang chủ ",-1)])]),_:1})])):o.value?(l(),a("div",vt,[t("div",pt,[t("div",ht,[t("div",bt,[t("h1",gt,d(o.value.title),1),t("div",ft,[t("span",null,[s[3]||(s[3]=t("i",{class:"bi bi-person-circle"},null,-1)),u(" "+d(_.value),1)]),t("span",null,[s[4]||(s[4]=t("i",{class:"bi bi-calendar"},null,-1)),u(" "+d(C.value),1)]),o.value.updatedAt!==o.value.createdAt?(l(),a("span",yt,[...s[5]||(s[5]=[t("i",{class:"bi bi-pencil"},null,-1),u(" Đã chỉnh sửa ",-1)])])):g("",!0)]),A.value?(l(),a("div",_t,[k(h,{to:`/posts/${o.value.id}/edit`,class:"btn btn-outline-primary"},{default:I(()=>[...s[6]||(s[6]=[t("i",{class:"bi bi-pencil me-1"},null,-1),u(" Chỉnh sửa ",-1)])]),_:1},8,["to"]),t("button",{onClick:w,class:"btn btn-outline-danger"},[...s[7]||(s[7]=[t("i",{class:"bi bi-trash me-1"},null,-1),u(" Xóa ",-1)])])])):g("",!0)]),o.value.image?(l(),a("div",wt,[t("img",{src:o.value.image,alt:o.value.title,class:"img-fluid rounded shadow"},null,8,$t)])):g("",!0),t("div",kt,[t("p",xt,d(o.value.content),1)]),s[8]||(s[8]=t("hr",{class:"my-5"},null,-1)),k(rt,{comments:r.value,onAddComment:i,onDeleteComment:e},null,8,["comments"])])])])):g("",!0)])}}},Vt=R(Ct,[["__scopeId","data-v-fe4a19c9"]]);export{Vt as default};
